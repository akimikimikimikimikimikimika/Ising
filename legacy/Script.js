(()=>{let getResource=(id,o)=>{switch (id) {case "webgl":webgl=o;counter++;break;case "webgpu":webgpu=o;counter++;break;case "primitive":primitive=o;counter++;break;case "core":coreGenerator=o;counter++;break;}if (counter==4) {delete window.res;main();}};var counter=0;window.res=(id,o)=>getResource(id,o);let ce=t=>document.createElement(t),cd=(i,t)=>{let d=ce("div");if (i) d.id=i;if (t) d.textContent=t;return d;},ap=(p,c)=>p.appendChild(c),rc=c=>c.parentNode.removeChild(c),sa=(e,k,v)=>e.setAttribute(k,v),ra=(e,k)=>e.removeAttribute(k),ael=(e,t,f)=>e.addEventListener(t,f),sc=(e,c)=>{if (c) sa(e,"class",c);else ra(e,"class");return e;},valid=v=>v!=undefined,html=document.documentElement,body=document.body;let l=["webgl","webgpu","primitive","core"];l.forEach(s=>{let e=ce("script");sa(e,"src",`legacy/${s}.js`);ap(document.head,e);});var webgl,webgpu,primitive,coreGenerator;let main=()=>{let status=(o=>{let s=new Proxy(o,{set:(t,p,v)=>{let changed=t[p]!=v;t[p]=v;if (changed) switch (p) {case "side":core.sideUpdate();break;case "render":modeList(v);core.rendererUpdate();break;case "cryptoRng":if (rngList) rngList(v);break;case "paused":if (v) core.pause();else core.resume();break;}let c=[t.colorSchemePreferred?"pcs":(t.dark?"dark":"light")];if (t.standalone) c.push("standalone");if (t.input=="Touch") c.push("touch");if (t.noMin) c.push("no-min");if (t.browser!=null) c.push(t.browser.toLowerCase());sc(html,c.join(" "));}});var rng=false;try{if (window.crypto.getRandomValues&&Uint32Array) rng=true;}catch(e){rng=false;}s.cryptoRng=rng;let test=cd();s.input=test.ontouchstart===null?"Touch":"Mouse";s.online=(()=>{let p=location.protocol;return /https/.test(p)||(/http/.test(p)&&location.hostname=="localhost");})();s.standalone=navigator.standalone===true||(/standalone=yes/).test(location.search);let mm=s=>window.matchMedia(`(prefers-color-scheme: ${s})`).matches;s.colorSchemePreferred=mm("light")||mm("dark");s.noMin=!CSS.supports("width","min(100vw,100vh)");if (window.ApplePaySession) s.browser="Safari";if (window.chrome) s.browser="Chrome";if (window.sidebar) s.browser="Firefox";return s;})({side:50,T:4,J:1,H:0,render:0,cryptoRng:false,paused:false,failed:false,standalone:false,noMin:false,dark:false,online:false,colorSchemePreferred:false,browser:null});if (status.online) try{navigator.serviceWorker.register("ServiceWorker.js");}catch(e){}let base=cd("base");while (body.firstChild) rc(body.firstChild);ap(body,base);let renderer=[].concat(webgl,webgpu,primitive).filter(v=>v);let core=coreGenerator(status,renderer,base);var modeList,rngList;(()=>{let mr=p=>{let e=cd(),n=cd(),s=cd(),i=ce("input"),v=cd();sc(e,"range");sc(n,"name");sc(s,"slider");sc(v,"value");i.type="range";if (valid(p.name)) n.textContent=p.name;if (valid(p.min)) sa(i,"min",p.min);if (valid(p.max)) sa(i,"max",p.max);if (valid(p.step)) sa(i,"step",p.step);if (valid(p.value)) {i.value=p.value;v.textContent=p.value;}ael(i,"change",e=>{if (p.action) p.action(i.value-0);v.textContent=i.value;e.stopPropagation();});ap(e,n);ap(ap(e,s),i);ap(e,v);return e;};let mb=(d,a)=>{var active=false;let eh=[e=>{active=true;e.stopPropagation();},e=>{if (active) active=false;e.stopPropagation();},e=>{if (active) a();active=false;e.stopPropagation();}];sa(d,"role","button");if (status.input=="Touch") {ael(d,"touchstart",eh[0]);ael(d,"touchmove",eh[1]);ael(d,"touchcancel",eh[1]);ael(d,"touchend",eh[2]);}else {ael(d,"mousedown",eh[0]);ael(d,"mousemove",eh[1]);ael(d,"mouseout",eh[1]);ael(d,"mouseup",eh[2]);}return d;};let mc=(n,c,a)=>{let l=cd(),cb=cd(),nm=cd(null,n);sc(l,`list${c?" checked":""}`);sc(cb,"checkbox");sc(nm,"name");ap(l,cb);ap(l,nm);mb(l,()=>a(l));return l;};let cap=t=>{let e=cd(null,t);sc(e,"caption");return e;};let mrs=(n,v)=>mc(n,v==status.render,()=>status.render=v);let m=ap(base,cd("menu"));ap(m,cap("Parameters"));ap(m,mr({min:0,max:4,step:0.25,value:status.T,id:"t",name:"T",action:v=>status.T=v}));ap(m,mr({min:-6,max:6,step:2,value:status.H,id:"h",name:"H",action:v=>status.H=v}));ap(m,mr({min:-1,max:1,step:1,value:status.J,id:"j",name:"J",action:v=>status.J=v}));ap(m,mr({min:8,max:150,step:1,value:status.side,id:"side",name:"pixels",action:v=>status.side=v}));ap(m,mc("Pause",status.paused,c=>{if (!status.failed) {status.paused=!status.paused;sc(c,`list ${status.paused?" checked":""}`);}}));ap(m,cap("Renderer"));let ml=renderer.map((o,i)=>ap(m,mrs(o.name,i)));modeList=v=>ml.forEach((e,i)=>sc(e,`list${v==i?" checked":""}`));ap(m,cap("RNG"));let rng=status.cryptoRng;let rl=[ap(m,mc("Normal",!rng,()=>status.cryptoRng=false))];if (rng) rl.push(ap(m,mc("Crypto",rng,()=>status.cryptoRng=true)));rngList=v=>rl.forEach((e,i)=>sc(e,`list${status.cryptoRng==!!i?" checked":""}`));})();};})();